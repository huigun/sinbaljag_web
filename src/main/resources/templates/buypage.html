<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>신발장</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/header.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/content.css}"/>
<link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}">
<link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>

</head>
<script th:inline="javascript">

    	const checkbox = document.getElementById('inputinfo');
        const is_checked = checkbox.checked;
    function allChecked(target){
		

        
        var arr4 = new Array(); // 인덱스

        for(var i=0;i<document.querySelectorAll(".chk").length;i++){
            		if(document.querySelectorAll(".chk")[i].checked==true){
            			arr4.push(i);
            		}
            	}
            	document.getElementById("bindex").value =arr4;
            	
        
        var psum = 0;
    	const arr = new Array();
    	document.querySelectorAll('input[name="chk"]:checked').forEach(function(v, i) {
            arr[i] = v.value;
        });
    	if(arr.length>0){
    		for(var i=0;i<arr.length;i++){
    			psum = psum + parseInt(arr[i]);
    		} 
    	} else {
    			psum = 0;
    	} 
    	const cn1 = psum.toString()
  	 	 .replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
  		document.getElementById("psum").innerHTML =cn1;
    }
    
    var is_checked2;
    var checkbox2 ;
    var chk2;
    var is_chk2;
    //자식 체크박스 클릭 이벤트
    function chkClicked(){
    	var psum = 0;
    	
    	const arr = new Array(); // 가격
    	const arr2 = new Array(); // 제품명
    	const arr3 = new Array(); // 사이즈
    	var arr4 = new Array(); // 인덱스
    	//document.querySelectorAll(".chk").forEach(function(v, i) {
        //    if(v.checked==true){
		//		alert(i)
        //    }
       	// });
    	for(var i=0;i<document.querySelectorAll(".chk").length;i++){
    		if(document.querySelectorAll(".chk")[i].checked==true){
    			arr4.push(i);
    		}
    	}
    	document.getElementById("bindex").value =arr4;
    	
    	document.querySelectorAll('input[name="chk"]:checked').forEach(function(v, i) {
            arr[i] = v.value;
        });
    	
    	document.querySelectorAll('input[name="accept1"]:checked').forEach(function(v, i) {
            arr2[i] = v.value;
        });
    	
    	document.querySelectorAll('input[name="accept2"]:checked').forEach(function(v, i) {
            arr3[i] = v.value;
        });
    	
    	if(arr.length>0){
    		for(var i=0;i<arr.length;i++){
    			psum = psum + parseInt(arr[i]);
    		} 
    	} else {
    			psum = 0;
    	} 
    	const cn1 = psum.toString()
    	  .replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");
    	document.getElementById("psum").innerHTML =cn1;
    	
        //체크된 체크박스 전체개수
        const allCount = document.querySelectorAll(".chk").length;
        const query = 'input[name="chk"]:checked'
        const selectedElements = document.querySelectorAll(query)
        const selectedElementsCnt = selectedElements.length;

        //체크박스 전체개수와 체크된 체크박스 전체개수가 같으면 전체 체크박스 체크
        if(allCount == selectedElementsCnt){
             document.getElementById('allCheckBox').checked = true;
        }

        //같지않으면 전체 체크박스 해제
        else{
            document.getElementById('allCheckBox').checked = false;
        }
        
        // 여기
    }

    //체크박스 전체 체크
    function chkAllChecked(){
        document.querySelectorAll(".chk").forEach(function(v, i) {
            v.checked = true;
        });
        
    }

    //체크박스 전체 체크 해제
    function chkAllUnChecked(){
        document.querySelectorAll(".chk").forEach(function(v, i) {
            v.checked = false;
        });
    }
    
    function chkAllChecked2(){
    	document.querySelectorAll(".accept1").forEach(function(v, i) {
            v.checked = true;
        });
    	document.querySelectorAll(".accept2").forEach(function(v, i) {
            v.checked = true;
        });
    	document.getElementById('accept1').checked = true;
    	document.getElementById('accept2').checked = true;
    }
    
    function chkAllUnChecked2(){
    	document.getElementById('accept1').checked = false;
    	document.getElementById('accept2').checked = false;
    }
	
    
</script>
<body id="bc">
<div id="wrap">
	<!-- 헤더 시작 -->
	<th:block th:replace="fragment/header :: headerFragment"></th:block>
   	<!-- 헤더 끝 -->
   	<div id="wrapc">
  	<!-- 컨텐츠 시작 -->
  	<!-- 장바구니 헤드 시작 -->
  	<form th:action="buy" method="post">
  	<span class="iib bborder bpf000 bpf001 siu bbr">
  		<span class="iib wwidth tac mmb">
  			<span><주문자 정보></span>
  		</span>
  		<span class="iib wwidth tac mmb">
  		<span>주문자명</span>
  		<span>
			<input type="text" id="mname" name="mname" th:placeholder="${member.smname}">
		</span>
  		</span>
  		<span class="iib wwidth tac mmb">
  		<span>전화번호</span>
  		<span>
  			<input type="text" id="mtel" name="mtel" th:placeholder="${member.smtel}">
  		</span>
  		</span>
  		<span class="iib wwidth tac">
  		<span class="mmr">주소</span>
  		<span>
  			<input type="text" id="maddress" name="maddress" th:placeholder="${member.smaddress}">
  		</span>
  		</span>
  		<span class="iib wwidth tac mmt">
  		</span>
  	</span>
	  	<span class="iib bborder2 bpf000 bbr">
		  	<span class="iib bpf0 siu">
		 			<span class="iib bpf1">
		  			번호
		  			</span>
		  			<span class="iib bpf2">
		  			상품명
		  			</span>
		  			<span class="iib bpf3">
		  			사이즈
		  			</span>
		  			<span class="iib bpf3">
		  			가격
		  			</span>
		  			<span class="iib bpf3">
		  			수량
		  			</span>
		  			<span class="iib bpf3">
		  			합계
		  			</span>
		  	</span>
		  	<!-- 장바구니 헤드 끝 -->
			<span id="bbc2">
			<!-- 장바구니 리스트 시작 -->
			<th:block th:each="bk, i : ${buy}">
				<span class="blist2 iib siu">
					<span class="iib bpf1">
		  				<th:block th:text="${i.count}">
		  			</span>
		  			<span class="">
		  				<input class="ckb2 chk" type="checkbox" name="chk" id="chk" onclick="chkClicked()" th:value="${bk.bypprice}" checked>
		  			</span>
		  			<span class="iib bpf2">
		  			<img th:src="${bk.bypimage}" width="50" height="50" class="imagebg2"/>
		  			<th:block th:text="${bk.bypname}"></th:block>
		  			</span>
		  			<span class="iib bpf3">
		  			<th:block th:text="${bk.bypsize}"></th:block>
		  			</span>
		  			<span class="iib bpf3">
		  			<th:block th:text="${#numbers.formatInteger(bk.bypprice, 0, 'COMMA')}+원"></th:block>
		  			</span>
		  			<span class="iib bpf3">
		  			<th:block th:text="${bk.bycount}"></th:block>
		  			</span>
		  			<span class="iib bpf3">
		  			<th:block th:text="${#numbers.formatInteger(bk.bypprice*bk.bycount, 0, 'COMMA')}+원"></th:block>
		  			</span>
		  		</span>
		  	</th:block>
		  	</span>
	  	</span>
  	<!-- 장바구니 리스트 끝 -->
	  	<span class="iib bborder bpf0002 bbr tac">
	  		<span class="sb222 siu">
		  	<span>최종 금액 =</span>
		  	<span id="psum">0</span>
		  	</span>
		  	<span class="sb000">
		  	원
		  	</span>
		  	<span class="">
		  	<input type="hidden" name="bindex" id="bindex">
		  	<input type="submit" value="결제하기" class="iib siu">
		  	</span>
	  	</span>
  	</form>
  	<!-- 컨텐츠 끝 -->
   	</div>
   	<!-- 푸터 시작 -->
	<!-- 푸터 끝 -->
	</div>
	<script type="text/javascript">
	function chkAllChecked(){
        document.querySelectorAll(".chk").forEach(function(v, i) {
            v.checked = true;
        });
    }
	
	chkAllChecked()
	chkClicked()
	</script>
</body>
</html>
